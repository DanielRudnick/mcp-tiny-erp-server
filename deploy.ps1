# Script de Deploy para MCP Tiny ERP Server (PowerShell)
# Uso: .\deploy.ps1

Write-Host "==========================================" -ForegroundColor Cyan
Write-Host "üöÄ DEPLOY - MCP TINY ERP SERVER" -ForegroundColor Cyan
Write-Host "==========================================" -ForegroundColor Cyan
Write-Host ""

# Fun√ß√£o para printar com cor
function Print-Success {
    param($Message)
    Write-Host "‚úÖ $Message" -ForegroundColor Green
}

function Print-Error {
    param($Message)
    Write-Host "‚ùå $Message" -ForegroundColor Red
}

function Print-Info {
    param($Message)
    Write-Host "‚ÑπÔ∏è  $Message" -ForegroundColor Yellow
}

# Verifica se est√° no diret√≥rio correto
if (-not (Test-Path "requirements.txt")) {
    Print-Error "Execute este script no diret√≥rio raiz do projeto!"
    exit 1
}

Print-Success "Diret√≥rio correto verificado"

# Verifica se git est√° inicializado
if (-not (Test-Path ".git")) {
    Print-Error "Reposit√≥rio git n√£o inicializado!"
    Print-Info "Execute: git init"
    exit 1
}

Print-Success "Reposit√≥rio git encontrado"

# Adiciona novos arquivos
Write-Host ""
Print-Info "Adicionando novos arquivos ao git..."

try {
    git add src/api/mcp_tools_completo.py
    git add src/services/tiny_client.py
    git add NOVO_MCP_TOOLS_COMPLETO.md
    git add EXEMPLOS_USO_NOVAS_FERRAMENTAS.md
    git add RELATORIO_TESTES.md
    git add test_novas_ferramentas.py
    git add GUIA_DEPLOY_COMPLETO.md
    git add deploy.sh
    git add deploy.ps1

    Print-Success "Arquivos adicionados"
} catch {
    Print-Error "Erro ao adicionar arquivos"
    exit 1
}

# Verifica status
Write-Host ""
Print-Info "Status do reposit√≥rio:"
git status --short

# Commit
Write-Host ""
$commit = Read-Host "üìù Deseja fazer commit? (y/n)"
if ($commit -eq "y" -or $commit -eq "Y") {
    $commitMessage = @"
feat: adicionar 120+ novos endpoints da API Tiny

- Implementados todos os endpoints da API Tiny V2
- Adicionados m√©todos para: Contatos, Produtos, CRM, Contas, Notas Fiscais, PDV, Expedi√ß√µes, etc
- Sistema de cache e rate limiting implementado
- Documenta√ß√£o completa e exemplos de uso
- Testes de valida√ß√£o criados
- 100% de cobertura da API Tiny
- Scripts de deploy automatizados
"@

    git commit -m $commitMessage
    Print-Success "Commit realizado"
}

# Push
Write-Host ""
$push = Read-Host "üöÄ Deseja fazer push para o GitHub? (y/n)"
if ($push -eq "y" -or $push -eq "Y") {
    $branch = git rev-parse --abbrev-ref HEAD
    git push origin $branch
    Print-Success "Push realizado para branch: $branch"
}

# Informa√ß√µes
Write-Host ""
Write-Host "==========================================" -ForegroundColor Cyan
Write-Host "‚úÖ PR√ìXIMOS PASSOS" -ForegroundColor Cyan
Write-Host "==========================================" -ForegroundColor Cyan
Write-Host ""
Write-Host "1Ô∏è‚É£  Acesse Railway: https://railway.app"
Write-Host "2Ô∏è‚É£  Crie novo projeto: 'New Project' ‚Üí 'Deploy from GitHub'"
Write-Host "3Ô∏è‚É£  Selecione: mcp-tiny-erp-server"
Write-Host "4Ô∏è‚É£  Adicione PostgreSQL: 'New' ‚Üí 'Database' ‚Üí 'PostgreSQL'"
Write-Host "5Ô∏è‚É£  Adicione Redis: 'New' ‚Üí 'Database' ‚Üí 'Redis'"
Write-Host "6Ô∏è‚É£  Configure vari√°veis (veja GUIA_DEPLOY_COMPLETO.md)"
Write-Host "7Ô∏è‚É£  Aguarde deploy (3-5 minutos)"
Write-Host ""
Write-Host "üìñ Guia completo: GUIA_DEPLOY_COMPLETO.md"
Write-Host "üìä Relat√≥rio de testes: RELATORIO_TESTES.md"
Write-Host "üìö Exemplos de uso: EXEMPLOS_USO_NOVAS_FERRAMENTAS.md"
Write-Host ""
Write-Host "==========================================" -ForegroundColor Cyan
Print-Success "Script conclu√≠do com sucesso!"
Write-Host "==========================================" -ForegroundColor Cyan
Write-Host ""
Write-Host "üí° DICA: Para gerar SECRET_KEY, execute:" -ForegroundColor Yellow
Write-Host "   [System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes([System.Guid]::NewGuid().ToString() + [System.Guid]::NewGuid().ToString()))" -ForegroundColor Gray
