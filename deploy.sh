#!/bin/bash

# Script de Deploy para MCP Tiny ERP Server
# Uso: ./deploy.sh

set -e

echo "=========================================="
echo "üöÄ DEPLOY - MCP TINY ERP SERVER"
echo "=========================================="
echo ""

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Fun√ß√£o para printar com cor
print_success() {
    echo -e "${GREEN}‚úÖ $1${NC}"
}

print_error() {
    echo -e "${RED}‚ùå $1${NC}"
}

print_info() {
    echo -e "${YELLOW}‚ÑπÔ∏è  $1${NC}"
}

# Verifica se est√° no diret√≥rio correto
if [ ! -f "requirements.txt" ]; then
    print_error "Execute este script no diret√≥rio raiz do projeto!"
    exit 1
fi

print_success "Diret√≥rio correto verificado"

# Verifica se git est√° inicializado
if [ ! -d ".git" ]; then
    print_error "Reposit√≥rio git n√£o inicializado!"
    print_info "Execute: git init"
    exit 1
fi

print_success "Reposit√≥rio git encontrado"

# Adiciona novos arquivos
echo ""
print_info "Adicionando novos arquivos ao git..."

git add src/api/mcp_tools_completo.py
git add src/services/tiny_client.py
git add NOVO_MCP_TOOLS_COMPLETO.md
git add EXEMPLOS_USO_NOVAS_FERRAMENTAS.md
git add RELATORIO_TESTES.md
git add test_novas_ferramentas.py
git add GUIA_DEPLOY_COMPLETO.md
git add deploy.sh
git add deploy.ps1

print_success "Arquivos adicionados"

# Verifica status
echo ""
print_info "Status do reposit√≥rio:"
git status --short

# Commit
echo ""
read -p "üìù Deseja fazer commit? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
    git commit -m "feat: adicionar 120+ novos endpoints da API Tiny

- Implementados todos os endpoints da API Tiny V2
- Adicionados m√©todos para: Contatos, Produtos, CRM, Contas, Notas Fiscais, PDV, Expedi√ß√µes, etc
- Sistema de cache e rate limiting implementado
- Documenta√ß√£o completa e exemplos de uso
- Testes de valida√ß√£o criados
- 100% de cobertura da API Tiny
- Scripts de deploy automatizados"

    print_success "Commit realizado"
fi

# Push
echo ""
read -p "üöÄ Deseja fazer push para o GitHub? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
    BRANCH=$(git rev-parse --abbrev-ref HEAD)
    git push origin $BRANCH
    print_success "Push realizado para branch: $BRANCH"
fi

# Informa√ß√µes
echo ""
echo "=========================================="
echo "‚úÖ PR√ìXIMOS PASSOS"
echo "=========================================="
echo ""
echo "1Ô∏è‚É£  Acesse Railway: https://railway.app"
echo "2Ô∏è‚É£  Crie novo projeto: 'New Project' ‚Üí 'Deploy from GitHub'"
echo "3Ô∏è‚É£  Selecione: mcp-tiny-erp-server"
echo "4Ô∏è‚É£  Adicione PostgreSQL: 'New' ‚Üí 'Database' ‚Üí 'PostgreSQL'"
echo "5Ô∏è‚É£  Adicione Redis: 'New' ‚Üí 'Database' ‚Üí 'Redis'"
echo "6Ô∏è‚É£  Configure vari√°veis (veja GUIA_DEPLOY_COMPLETO.md)"
echo "7Ô∏è‚É£  Aguarde deploy (3-5 minutos)"
echo ""
echo "üìñ Guia completo: GUIA_DEPLOY_COMPLETO.md"
echo "üìä Relat√≥rio de testes: RELATORIO_TESTES.md"
echo "üìö Exemplos de uso: EXEMPLOS_USO_NOVAS_FERRAMENTAS.md"
echo ""
echo "=========================================="
print_success "Script conclu√≠do com sucesso!"
echo "=========================================="
